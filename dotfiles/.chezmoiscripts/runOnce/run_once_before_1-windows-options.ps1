# -----------------------------------
# author: @kiliantyler
# title: Windows Options
# description: Sets up Windows Options
# -----------------------------------

Write-Host "Setting up Windows Options..."

# -----------------------------------
# Disable UCPDMgr.exe
# This is a sourge on Windows 11, and it is only for babies who don't know how to use a computer.
# -----------------------------------

# Check if this doesn't exist, if not create it
if (!(Test-Path "HKLM:\SYSTEM\CurrentControlSet\Services\UCPD")) {
    New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\UCPD" -Name "Start" -Value 4 -PropertyType DWORD -Force
}
Disable-ScheduledTask -TaskName '\Microsoft\Windows\AppxDeploymentClient\UCPD velocity' | Out-Null

# -----------------------------------
# Windows Explorer Options
# -----------------------------------

# Set Windows Explorer to show hidden files
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "Hidden" -Value 1

# Set Windows Explorer to show file extensions
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "HideFileExt" -Value 0

# -----------------------------------
# Taskbar Options
# -----------------------------------

# Hide Taskbar Search Icon
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Search" -Name "SearchboxTaskbarMode" -Value 0

# Hide Taskview Button
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "ShowTaskViewButton" -Value 0

# Hide Widgets is BLOCKED BY MICROSHIT
# Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "TaskbarDa" -Value 0

# This disables the widgets button on the taskbar -- Thanks @HumbertoFreitas (https://www.reddit.com/r/sysadmin/comments/1ff8orh/comment/m64nsao)
Start-Process -FilePath $Env:SystemRoot\System32\MSHta.exe -ArgumentList @(
	'"javascript:window.moveTo(window.screen.width, window.screen.height);'
  "new ActiveXObject('WScript.Shell').RegWrite('HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\TaskbarDa', 0, 'REG_DWORD');"
  'close();"'
)

# Taskbar Icons
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "TaskbarGlomLevel" -Value 0

# Taskbar Alignment - Center
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "TaskbarAl" -Value 1

# Taskbar Combination - Always Combine
Set-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "TaskbarMn" -Value 0 -ErrorAction SilentlyContinue

# Taskbar - Enable MultiMonitor Taskbar
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "MMTaskbarEnabled" -Value 1 -PropertyType DWORD -Force

# Taskbar - Set icons to only show on monitor with window
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "MMTaskbarMode" -Value 2 -PropertyType DWORD -Force

# Enable End Task on Taskbar
# First create the registry key path
New-Item -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\TaskbarDeveloperSettings" -Force | Out-Null
# Then set the property
New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\TaskbarDeveloperSettings" -Name "TaskbarEndTask" -Value 1 -PropertyType DWORD -Force

# Remove Edge from Taskbar
Remove-Item -Path "$env:AppData\Microsoft\Internet Explorer\Quick Launch\User Pinned\TaskBar\Microsoft Edge.lnk" -Force -Recurse -ErrorAction SilentlyContinue

# Set Favorites
New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Taskband\" -Name "FavoritesResolve" -Value ([byte[]](0x3b,0x03,0x00,0x00,0x4c,0x00,0x00,0x00,0x01,0x14,0x02,0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x46,0x83,0x00,0x80,0x00,0x20,0x00,0x00,0x00,0xbc,0x8b,0x6c,0x93,0xad,0x01,0xda,0x01,0xdb,0x54,0x7a,0x93,0xad,0x01,0xda,0x01,0x5c,0xf4,0xe1,0xfb,0xd1,0x61,0xd8,0x01,0x97,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xa0,0x01,0x3a,0x00,0x1f,0x80,0xc8,0x27,0x34,0x1f,0x10,0x5c,0x10,0x42,0xaa,0x03,0x2e,0xe4,0x52,0x87,0xd6,0x68,0x26,0x00,0x01,0x00,0x26,0x00,0xef,0xbe,0x12,0x00,0x00,0x00,0x9d,0x8d,0xb4,0x1e,0x3e,0x00,0xda,0x01,0x3b,0x64,0x5d,0x4e,0x3e,0x00,0xda,0x01,0x81,0xc2,0x73,0x93,0xad,0x01,0xda,0x01,0x14,0x00,0x56,0x00,0x31,0x00,0x00,0x00,0x00,0x00,0x52,0x57,0x53,0x53,0x11,0x00,0x54,0x61,0x73,0x6b,0x42,0x61,0x72,0x00,0x40,0x00,0x09,0x00,0x04,0x00,0xef,0xbe,0x50,0x57,0xb3,0x74,0x52,0x57,0x53,0x53,0x2e,0x00,0x00,0x00,0xd2,0xa3,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7f,0x40,0x42,0x00,0x54,0x00,0x61,0x00,0x73,0x00,0x6b,0x00,0x42,0x00,0x61,0x00,0x72,0x00,0x00,0x00,0x16,0x00,0x0e,0x01,0x32,0x00,0x97,0x01,0x00,0x00,0xa7,0x54,0x66,0x2a,0x20,0x00,0x46,0x49,0x4c,0x45,0x45,0x58,0x7e,0x31,0x2e,0x4c,0x4e,0x4b,0x00,0x00,0x7c,0x00,0x09,0x00,0x04,0x00,0xef,0xbe,0x52,0x57,0x53,0x53,0x52,0x57,0x53,0x53,0x2e,0x00,0x00,0x00,0xfc,0x4e,0x01,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x52,0x00,0x00,0x00,0x00,0x00,0xa4,0x13,0xa2,0x00,0x46,0x00,0x69,0x00,0x6c,0x00,0x65,0x00,0x20,0x00,0x45,0x00,0x78,0x00,0x70,0x00,0x6c,0x00,0x6f,0x00,0x72,0x00,0x65,0x00,0x72,0x00,0x2e,0x00,0x6c,0x00,0x6e,0x00,0x6b,0x00,0x00,0x00,0x40,0x00,0x73,0x00,0x68,0x00,0x65,0x00,0x6c,0x00,0x6c,0x00,0x33,0x00,0x32,0x00,0x2e,0x00,0x64,0x00,0x6c,0x00,0x6c,0x00,0x2c,0x00,0x2d,0x00,0x32,0x00,0x32,0x00,0x30,0x00,0x36,0x00,0x37,0x00,0x00,0x00,0x1c,0x00,0x22,0x00,0x00,0x00,0x1e,0x00,0xef,0xbe,0x02,0x00,0x55,0x00,0x73,0x00,0x65,0x00,0x72,0x00,0x50,0x00,0x69,0x00,0x6e,0x00,0x6e,0x00,0x65,0x00,0x64,0x00,0x00,0x00,0x1c,0x00,0x12,0x00,0x00,0x00,0x2b,0x00,0xef,0xbe,0xdb,0x54,0x7a,0x93,0xad,0x01,0xda,0x01,0x1c,0x00,0x42,0x00,0x00,0x00,0x1d,0x00,0xef,0xbe,0x02,0x00,0x4d,0x00,0x69,0x00,0x63,0x00,0x72,0x00,0x6f,0x00,0x73,0x00,0x6f,0x00,0x66,0x00,0x74,0x00,0x2e,0x00,0x57,0x00,0x69,0x00,0x6e,0x00,0x64,0x00,0x6f,0x00,0x77,0x00,0x73,0x00,0x2e,0x00,0x45,0x00,0x78,0x00,0x70,0x00,0x6c,0x00,0x6f,0x00,0x72,0x00,0x65,0x00,0x72,0x00,0x00,0x00,0x1c,0x00,0x00,0x00,0xa4,0x00,0x00,0x00,0x1c,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x1c,0x00,0x00,0x00,0x2d,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xa3,0x00,0x00,0x00,0x11,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0xd1,0x7d,0xbc,0x80,0x10,0x00,0x00,0x00,0x00,0x43,0x3a,0x5c,0x55,0x73,0x65,0x72,0x73,0x5c,0x41,0x64,0x6d,0x69,0x6e,0x69,0x73,0x74,0x72,0x61,0x74,0x6f,0x72,0x5c,0x41,0x70,0x70,0x44,0x61,0x74,0x61,0x5c,0x52,0x6f,0x61,0x6d,0x69,0x6e,0x67,0x5c,0x4d,0x69,0x63,0x72,0x6f,0x73,0x6f,0x66,0x74,0x5c,0x49,0x6e,0x74,0x65,0x72,0x6e,0x65,0x74,0x20,0x45,0x78,0x70,0x6c,0x6f,0x72,0x65,0x72,0x5c,0x51,0x75,0x69,0x63,0x6b,0x20,0x4c,0x61,0x75,0x6e,0x63,0x68,0x5c,0x55,0x73,0x65,0x72,0x20,0x50,0x69,0x6e,0x6e,0x65,0x64,0x5c,0x54,0x61,0x73,0x6b,0x42,0x61,0x72,0x5c,0x46,0x69,0x6c,0x65,0x20,0x45,0x78,0x70,0x6c,0x6f,0x72,0x65,0x72,0x2e,0x6c,0x6e,0x6b,0x00,0x00,0x60,0x00,0x00,0x00,0x03,0x00,0x00,0xa0,0x58,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x64,0x65,0x73,0x6b,0x74,0x6f,0x70,0x2d,0x76,0x65,0x68,0x31,0x34,0x72,0x75,0x00,0x62,0x0c,0x54,0xcc,0x7c,0xd9,0x60,0x4c,0xbd,0x73,0xb8,0xc1,0x3a,0x20,0x88,0x43,0x77,0x8f,0x36,0x21,0x8c,0x6d,0xee,0x11,0xa2,0x0e,0x08,0x00,0x27,0xa3,0x82,0x04,0x62,0x0c,0x54,0xcc,0x7c,0xd9,0x60,0x4c,0xbd,0x73,0xb8,0xc1,0x3a,0x20,0x88,0x43,0x77,0x8f,0x36,0x21,0x8c,0x6d,0xee,0x11,0xa2,0x0e,0x08,0x00,0x27,0xa3,0x82,0x04,0x45,0x00,0x00,0x00,0x09,0x00,0x00,0xa0,0x39,0x00,0x00,0x00,0x31,0x53,0x50,0x53,0xb1,0x16,0x6d,0x44,0xad,0x8d,0x70,0x48,0xa7,0x48,0x40,0x2e,0xa4,0x3d,0x78,0x8c,0x1d,0x00,0x00,0x00,0x68,0x00,0x00,0x00,0x00,0x48,0x00,0x00,0x00,0xb6,0xd0,0x8a,0x15,0x4c,0xd4,0x9a,0x41,0x92,0xb0,0xf9,0x18,0xa2,0xe5,0x4d,0x95,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00)) -PropertyType Binary -Force -ErrorAction SilentlyContinue
New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Taskband\" -Name "Favorites" -Value ([byte[]](0x00,0xa0,0x01,0x00,0x00,0x3a,0x00,0x1f,0x80,0xc8,0x27,0x34,0x1f,0x10,0x5c,0x10,0x42,0xaa,0x03,0x2e,0xe4,0x52,0x87,0xd6,0x68,0x26,0x00,0x01,0x00,0x26,0x00,0xef,0xbe,0x12,0x00,0x00,0x00,0x9d,0x8d,0xb4,0x1e,0x3e,0x00,0xda,0x01,0x3b,0x64,0x5d,0x4e,0x3e,0x00,0xda,0x01,0x81,0xc2,0x73,0x93,0xad,0x01,0xda,0x01,0x14,0x00,0x56,0x00,0x31,0x00,0x00,0x00,0x00,0x00,0x52,0x57,0x53,0x53,0x11,0x00,0x54,0x61,0x73,0x6b,0x42,0x61,0x72,0x00,0x40,0x00,0x09,0x00,0x04,0x00,0xef,0xbe,0x50,0x57,0xb3,0x74,0x52,0x57,0x53,0x53,0x2e,0x00,0x00,0x00,0xd2,0xa3,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7f,0x40,0x42,0x00,0x54,0x00,0x61,0x00,0x73,0x00,0x6b,0x00,0x42,0x00,0x61,0x00,0x72,0x00,0x00,0x00,0x16,0x00,0x0e,0x01,0x32,0x00,0x97,0x01,0x00,0x00,0xa7,0x54,0x66,0x2a,0x20,0x00,0x46,0x49,0x4c,0x45,0x45,0x58,0x7e,0x31,0x2e,0x4c,0x4e,0x4b,0x00,0x00,0x7c,0x00,0x09,0x00,0x04,0x00,0xef,0xbe,0x52,0x57,0x53,0x53,0x52,0x57,0x53,0x53,0x2e,0x00,0x00,0x00,0xfc,0x4e,0x01,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x52,0x00,0x00,0x00,0x00,0x00,0xa4,0x13,0xa2,0x00,0x46,0x00,0x69,0x00,0x6c,0x00,0x65,0x00,0x20,0x00,0x45,0x00,0x78,0x00,0x70,0x00,0x6c,0x00,0x6f,0x00,0x72,0x00,0x65,0x00,0x72,0x00,0x2e,0x00,0x6c,0x00,0x6e,0x00,0x6b,0x00,0x00,0x00,0x40,0x00,0x73,0x00,0x68,0x00,0x65,0x00,0x6c,0x00,0x6c,0x00,0x33,0x00,0x32,0x00,0x2e,0x00,0x64,0x00,0x6c,0x00,0x6c,0x00,0x2c,0x00,0x2d,0x00,0x32,0x00,0x32,0x00,0x30,0x00,0x36,0x00,0x37,0x00,0x00,0x00,0x1c,0x00,0x22,0x00,0x00,0x00,0x1e,0x00,0xef,0xbe,0x02,0x00,0x55,0x00,0x73,0x00,0x65,0x00,0x72,0x00,0x50,0x00,0x69,0x00,0x6e,0x00,0x6e,0x00,0x65,0x00,0x64,0x00,0x00,0x00,0x1c,0x00,0x12,0x00,0x00,0x00,0x2b,0x00,0xef,0xbe,0xdb,0x54,0x7a,0x93,0xad,0x01,0xda,0x01,0x1c,0x00,0x42,0x00,0x00,0x00,0x1d,0x00,0xef,0xbe,0x02,0x00,0x4d,0x00,0x69,0x00,0x63,0x00,0x72,0x00,0x6f,0x00,0x73,0x00,0x6f,0x00,0x66,0x00,0x74,0x00,0x2e,0x00,0x57,0x00,0x69,0x00,0x6e,0x00,0x64,0x00,0x6f,0x00,0x77,0x00,0x73,0x00,0x2e,0x00,0x45,0x00,0x78,0x00,0x70,0x00,0x6c,0x00,0x6f,0x00,0x72,0x00,0x65,0x00,0x72,0x00,0x00,0x00,0x1c,0x00,0x00,0x00,0xff)) -PropertyType Binary -Force -ErrorAction SilentlyContinue
New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Taskband\" -Name "FavoritesChanges" -Value 1 -PropertyType QWord -Force -ErrorAction SilentlyContinue
New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Taskband\" -Name "FavoritesVersion" -Value 3 -PropertyType QWord -Force -ErrorAction SilentlyContinue

# -----------------------------------
# Start Menu Options
# -----------------------------------

# Hide Recently Added Apps
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "Start_ShowRecentlyAddedApps" -Value 0

# Hide Most Used Apps
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "Start_ShowMostUsedApps" -Value 0

# Hide Recommended Apps
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "Start_IrisRecommendations" -Value 0

# Remove placeholdertilecollection registry entries
Get-ChildItem -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\CloudStore\Store\Cache\DefaultAccount" -Recurse |
    Where-Object { $_.PSPath -match "placeholdertilecollection" } |
    ForEach-Object { Remove-Item -Path "$($_.PSPath)\current" -Force -ErrorAction SilentlyContinue }

# First create the registry key path
New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\CloudContent" -Force | Out-Null

# Disable Startmenu suggestions
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\CloudContent" -Name "DisableWindowsConsumerFeatures" -Value 1 -PropertyType DWORD -Force

# Prevent Pre-Installed Apps from being installed again
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" -Name "ContentDeliveryAllowed" -PropertyType DWORD -Value 1 -Force
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" -Name "OemPreInstalledAppsEnabled" -PropertyType DWORD -Value 1 -Force
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" -Name "PreInstalledAppsEnabled" -PropertyType DWORD -Value 1 -Force
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" -Name "PreInstalledAppsEverEnabled" -PropertyType DWORD -Value 1 -Force
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" -Name "SilentInstalledAppsEnabled" -PropertyType DWORD -Value 1 -Force
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" -Name "SystemPaneSuggestionsEnabled" -PropertyType DWORD -Value 1 -Force

# Show folders in start menu (Settings, Personal Folder, FileExplorer)
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Start" -Name "VisiblePlaces" -Value ([byte[]](0x86,0x08,0x73,0x52,0xaa,0x51,0x43,0x42,0x9f,0x7b,0x27,0x76,0x58,0x46,0x59,0xd4,0xbc,0x24,0x8a,0x14,0x0c,0xd6,0x89,0x42,0xa0,0x80,0x6e,0xd9,0xbb,0xa2,0x48,0x82,0x4a,0xb0,0xbd,0x74,0x4a,0xf9,0x68,0x4f,0x8b,0xd6,0x43,0x98,0x07,0x1d,0xa8,0xbc))

# -----------------------------------
# Windows Update Options
# -----------------------------------

# Enable Get Latest Updates as soon as available
New-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\WindowsUpdate\UX\Settings" -Name "IsContinuousInnovationOptedIn" -Value 1 -PropertyType DWORD -Force -ErrorAction SilentlyContinue

# -----------------------------------
# Other Options
# -----------------------------------

# Disable Get Even More Out of Windows
New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\UserProfileEngagement" -Name "ScoobeSystemSettingEnabled" -Value 0 -PropertyType DWORD -Force -ErrorAction SilentlyContinue

# Disable bitlocker
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\EnhancedStorageDevices" -Name "TCGSecurityActivationDisabled" -Value 1 -PropertyType DWORD -Force -ErrorAction SilentlyContinue
New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\BitLocker" -Name "PreventDeviceEncryption" -Value 1 -PropertyType DWORD -Force -ErrorAction SilentlyContinue

# Enable Num Lock
New-ItemProperty -Path "Registry::HKU\.DEFAULT\Control Panel\Keyboard" -Name "InitialKeyboardIndicators" -Value "2" -PropertyType String -Force -ErrorAction SilentlyContinue

# UAC No Secure Desktop
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "PromptOnSecureDesktop" -Value 0 -Force

# Disable Windows Gaming Overlay
New-ItemProperty -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\GameDVR" -Name "AppCaptureEnabled" -PropertyType DWORD -Value 0 -Force
New-ItemProperty -Path "HKCU:\System\GameConfigStore" -Name "GameDVR_Enabled" -PropertyType DWORD -Value 0 -Force

# -----------------------------------
# Refresh Windows Explorer to apply changes
# -----------------------------------

Write-Host "Refreshing Windows Explorer..."

Stop-Process -Name "explorer" -Force -ErrorAction SilentlyContinue

Write-Host "Windows Options setup complete."
