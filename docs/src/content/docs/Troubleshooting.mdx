---
title: Troubleshooting
sidebar:
  order: 70
---

import { Aside, Steps } from "@astrojs/starlight/components";

Common issues and their solutions when working with these dotfiles.

## Age Key / Encryption Issues

### "age: error: no identity matched any of the recipients"

The age key hasn't been decrypted yet. During first-time setup, the `run_once_before_0-decrypt_age_key` script should handle this automatically, but if it failed:

<Steps>
1. Check that `key.txt.age` exists in the chezmoi source directory

2. Manually decrypt it:
   ```bash
   chezmoi age decrypt --output ~/.config/chezmoi/key.txt \
     ~/.local/share/chezmoi/dotfiles/key.txt.age
   ```

3. Re-run `chezmoi apply`
</Steps>

### Key file not found at `~/.config/chezmoi/key.txt`

The `run_once_before` script may have failed silently. Check that the source file `key.txt.age` exists and that you have the passphrase.

<Aside type="tip">
The age key is encrypted with a passphrase. You'll be prompted for it during first-time setup. If you don't have the passphrase, you can't decrypt any encrypted files in the repo.
</Aside>

## 1Password Issues

### "op: error: You are not signed in"

The 1Password service account token hasn't been configured. The token itself is stored encrypted in `op_service_account_token.age` — which means the age key must be decrypted first. It's a deliberate dependency chain:

<Steps>
1. Age key is decrypted (using passphrase)

2. 1Password service account token is decrypted (using age key)

3. Chezmoi templates that call `onepasswordRead` can now resolve
</Steps>

### 1Password template functions failing

If `chezmoi apply` fails on templates that use `{{ onepasswordRead "op://..." }}`, check:

- Is `OP_SERVICE_ACCOUNT_TOKEN` set in your environment?
- Is the 1Password CLI (`op`) installed and in your PATH?
- Is the vault accessible from the service account?

## Chezmoi Template Errors

### "option: missingkey=error"

A template references a variable that doesn't exist in the chezmoi data. This is intentional — `missingkey=error` catches typos early. Check `.chezmoidata/` files for the expected variable name.

### "function X not defined"

Usually means a 1Password template function is being called without 1Password being configured. On fresh installs, the age key must be decrypted before 1Password functions work. See the [Age Key](#age-key--encryption-issues) section above.

### Template renders incorrectly on my OS

Chezmoi templates use `{{ .chezmoi.os }}` for platform detection. Valid values are `darwin`, `linux`, and `windows`. Run `chezmoi data` to see what values chezmoi is using on your system.

## Platform-Specific Issues

### Windows: AppExecution Aliases break CLI tools

Winget-installed apps sometimes create AppExecution Aliases — stub executables that don't work properly over SSH or in non-interactive shells. This is why CLI tools on Windows are installed via [Scoop](/management-tools/) instead of Winget. Winget is reserved for GUI applications only.

### Windows: Scoop not in PATH

Scoop installs to `~/scoop/` and needs to be in PATH. The mise activation in the [PowerShell profile](/managed-dotfiles/shell) should handle this. If not, check that Scoop's shim directory is on your PATH:

```powershell
$env:PATH -split ";" | Select-String "scoop"
```

### macOS: Ansible fails with "sudo password required"

The Ansible playbook needs sudo access for `defaults write` commands. When running interactively, it prompts for your password. If running unattended (e.g., in a script), this will fail.

### macOS/Linux: Fish not found

Fish is installed via Homebrew on macOS (through the [Ansible playbook](/management-tools/ansible)). If it's not installed yet, run `chezmoi apply` to trigger the full setup pipeline. On Linux, install Fish through your distro's package manager.

## Missing Dependencies

### "command not found: mise"

mise is installed via Scoop on Windows and Homebrew on macOS. On fresh installs, it should be installed automatically during `chezmoi init`. For manual installation, see [mise.jdx.dev](https://mise.jdx.dev/getting-started.html).

### "command not found: starship" (or other CLI tools)

Most CLI tools are managed by [mise](https://mise.jdx.dev/). Run `mise install` in your home directory to install all configured tools. Check what's configured with `mise list`.

<Aside type="note">
Most first-time setup issues come down to ordering: the age key must be decrypted before 1Password works, and 1Password must work before templates referencing secrets can render. The `run_once` scripts handle this ordering automatically — if something went wrong, re-running `chezmoi apply` usually fixes it.
</Aside>

## General Debugging

A few useful commands when things aren't working:

```bash
# System health check
chezmoi doctor

# Preview what would change without applying
chezmoi diff

# Apply with verbose output
chezmoi apply --verbose

# See what data chezmoi is using for templates
chezmoi data

# Execute a specific template to test its output
chezmoi execute-template < some-file.tmpl
```
